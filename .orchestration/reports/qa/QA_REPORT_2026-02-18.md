# QA Report — 2026-02-18

## 1. Scope and Environment

| Item                | Value                                            |
| ------------------- | ------------------------------------------------ |
| **Project**         | betting-app backend (msa-template-1bis v1.0.122) |
| **Objective**       | Validate that all endpoints are working          |
| **Stack**           | Express 5 + Prisma 6 (MongoDB) + TypeScript 5.8  |
| **Test Runner**     | Mocha 11 + Chai 4 + Supertest 7                  |
| **Build Tool**      | Webpack 5.105                                    |
| **Modules**         | 17 CRUD modules + docs + health endpoints        |
| **Total Endpoints** | 93                                               |

## 2. Commands Executed

| #   | Command         | Exit Code | Result                                            |
| --- | --------------- | --------- | ------------------------------------------------- |
| 1   | `npm run build` | 1         | **FAIL** — 103 TypeScript errors                  |
| 2   | `npm run test`  | 1         | **FAIL** — Mocha aborts at compile time           |
| 3   | `npm run lint`  | 1         | **FAIL** — ESLint aborts (missing `lib-entry.ts`) |

## 3. Test Matrix Summary

| Status              | Count  | Percentage |
| ------------------- | ------ | ---------- |
| PASS                | 0      | 0%         |
| FAIL                | 19     | 58%        |
| BLOCKED             | 14     | 42%        |
| **Total Scenarios** | **33** |            |

- **0 of 33** scenarios passed
- **19 FAIL** — confirmed broken (TS compile errors in controllers)
- **14 BLOCKED** — cannot test because the build doesn't complete (template and health endpoints compile clean but can't start the server)

## 4. Defect Summary by Severity

| Severity  | Count | Description                                         |
| --------- | ----- | --------------------------------------------------- |
| CRITICAL  | 3     | Build failure, prisma.bet/commission model mismatch |
| HIGH      | 1     | Test suite completely blocked                       |
| MEDIUM    | 1     | Lint script broken                                  |
| **Total** | **5** |                                                     |

See `DEFECT_LOG_2026-02-18.csv` for details.

## 5. Root Cause

All 16 non-template controllers were **scaffolded from the template controller** but **never updated** to match their actual Prisma model fields. Each controller hardcodes references to `name`, `description`, `type`, and `isDeleted` — fields that only exist on the Template model.

### Error Pattern Per Controller:

| Location          | Error  | Explanation                                                                                                  |
| ----------------- | ------ | ------------------------------------------------------------------------------------------------------------ |
| `create()`        | TS2322 | `{ name, type, description, isDeleted }` passed to `prisma.X.create()` but model X doesn't have those fields |
| `create()` result | TS2339 | `result.name` / `result.description` accessed but model X doesn't have those fields                          |
| `getAll()` filter | TS2353 | `{ isDeleted: false }` filter used but model X has no `isDeleted` field                                      |
| `update()`        | TS2322 | `{ name, type, description }` passed to `prisma.X.update()` but model X doesn't have those fields            |

Additionally, **bet** and **commission** controllers reference `prisma.bet` and `prisma.commission` which don't exist on the Prisma client — the generated model names may differ.

## 6. Go / No-Go Decision

### **NO-GO** ❌

**Rationale:**

- Build does not compile — 103 TypeScript errors
- Tests cannot run — Mocha aborts at compile time
- Lint is broken — ESLint aborts due to missing file reference
- 0% of QA scenarios pass
- 86% of endpoints (80/93) are confirmed non-functional at compile time
- Remaining 14% (13/93) compile clean but cannot be runtime-tested because the server won't start

**No endpoint can be verified as working.**

## 7. Residual Risks

1. Even after fixing the compile errors, there may be **runtime issues** (wrong validation schemas, incorrect query logic, etc.) that are currently masked
2. The Zod schemas in `zod/` may also contain template-default fields that don't match the actual models
3. Test files in `tests/` may also reference template fields and need updating
4. Redis connection failures could block caching middleware at runtime

## 8. Recommended Fix Priority

| Priority | Action                                                                 | Owner               |
| -------- | ---------------------------------------------------------------------- | ------------------- |
| P0       | Run `npx prisma generate` to regenerate Prisma client                  | @DATABASE_ARCHITECT |
| P0       | Update each controller to use actual model fields from Prisma schema   | @BACKEND_DEVELOPER  |
| P0       | Update Zod schemas to match actual model fields                        | @BACKEND_DEVELOPER  |
| P1       | Fix lint script — remove `lib-entry.ts` from package.json lint command | @BACKEND_DEVELOPER  |
| P1       | Update test files to test actual model fields                          | @TEST_ENGINEER      |
| P2       | Re-run full pipeline after fixes                                       | @QA                 |
