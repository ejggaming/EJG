enum AgentRole {
  COBRADOR    // bet collector (kubrador) — earns 15% of stake
  CABO        // cobrador supervisor — earns bonus on winner payouts
  OPERATOR    // territory operator/maintainer
  CAPITALISTA // financier/backer — earns 25% of collections
  PAGADOR     // payout agent who physically pays winners
  BOLADOR     // tambiolo draw operator
}

enum AgentStatus {
  ACTIVE
  SUSPENDED
  INACTIVE
}

model Agent {
  id             String      @id @default(auto()) @map("_id") @db.ObjectId
  userId         String      @unique @db.ObjectId
  territoryId    String?     @db.ObjectId
  supervisorId   String?     @db.ObjectId // cabo who manages this agent
  role           AgentRole
  commissionRate Float       @default(0.15) // overrides config rate if set
  status         AgentStatus @default(ACTIVE)
  isActive       Boolean     @default(true)
  hiredAt        DateTime    @default(now())
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  user         User       @relation(fields: [userId], references: [id])
  territory    Territory? @relation(fields: [territoryId], references: [id])
  supervisor   Agent?     @relation("AgentHierarchy", fields: [supervisorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subordinates Agent[]    @relation("AgentHierarchy")

  collectedBets  JuetengBet[]    @relation("CobradorBets")
  supervisedBets JuetengBet[]    @relation("CaboBets")
  drawnDraws     JuetengDraw[]   @relation("BoladorDraws")
  commissions    DrawCommission[]
  payoutsIssued  JuetengPayout[] @relation("PagadorPayouts")

  @@index([territoryId])
  @@index([supervisorId])
  @@index([role])
  @@map("agents")
}
